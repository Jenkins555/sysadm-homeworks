# Домашнее задание к занятию "3.6. Компьютерные сети, лекция 1"

1. Необязательное задание:
можно посмотреть целый фильм в консоли `telnet towel.blinkenlights.nl` :)

1. Узнайте о том, сколько действительно независимых (не пересекающихся) каналов есть в разделяемой среде WiFi при работе на 2.4 ГГц. Стандарты с полосой 5 ГГц более актуальны, но регламенты на 5 ГГц существенно различаются в разных странах, а так же не раз обновлялись. В качестве дополнительного вопроса вне зачета, попробуйте найти актуальный ответ и на этот вопрос.   
  ```
      Количество действительно независимых каналов в разделяемой среде WiFi при работе на 2.4 ГГц зависит от нескольких факторов, включая ширину канала и наличие других сетей WiFi в окружении. В настоящее    время на 2.4 ГГц доступно 14 каналов, но на практике используется только 3 канала без пересечений (1, 6 и 11), так как другие каналы пересекаются с этими каналами и могут привести к пересечению сигналов и ухудшению качества сети. Кроме того, 2.4 ГГц является общей частотой для различных устройств, таких как беспроводные телефоны, микроволновые печи и Bluetooth-устройства, которые также могут мешать WiFi-сигналу.
     Что касается стандартов на 5 ГГц, то количество независимых каналов зависит от ширины канала и того, какие каналы разрешены в стране. Например, в США разрешены 24 независимых канала на 5 ГГц. В России на частоте 5 ГГц доступно до 19 независимых каналов, в зависимости от региона и режима работы устройств.

 ```


1. Адрес канального уровня – MAC адрес – это 6 байт, первые 3 из которых называются OUI – Organizationally Unique Identifier или уникальный идентификатор организации. Какому производителю принадлежит MAC `38:f9:d3:55:55:79`?   
    ```
       MAC адрес 38:f9:d3:55:55:79 принадлежит производителю устройств Apple, так как первые 3 байта (38:f9:d3) являются OUI, зарегистрированным для компании Apple Inc.
    ```


1. Каким будет payload TCP сегмента, если Ethernet MTU задан в 9001 байт, размер заголовков IPv4 – 20 байт, а TCP – 32 байта?   
  ```
       Для того чтобы определить размер полезной нагрузки TCP-сегмента, нужно вычесть из MTU Ethernet размер заголовков IPv4 и TCP. Получаем:
       9001 - 20 - 32 = 8949 байт   
       Это означает, что внутри TCP-сегмента может быть передано до 8949 байт данных, в зависимости от размера заголовков и других протоколов, используемых в сети.
  ```


1. Может ли во флагах TCP одновременно быть установлены флаги SYN и FIN при штатном режиме работы сети? Почему да или нет?   
  
    ```
     Нет, во флагах TCP одновременно не может быть установлены флаги SYN и FIN при штатном режиме работы сети. Это связано с тем, что флаг SYN используется для установления нового соединения между двумя узлами   сети, а флаг FIN используется для завершения соединения. Таким образом, установка обоих флагов одновременно противоречит нормальной логике работы протокола TCP. Если в сегменте установлены флаги SYN и FIN    одновременно, это может означать, что сегмент был создан с ошибкой или что в сети происходит атака.
    ```


1. `ss -ula sport = :53` на хосте имеет следующий вывод:

```bash
State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process
UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:*
```

Почему в `State` присутствует только `UNCONN`, и может ли там присутствовать, например, `TIME-WAIT`?   

    ```
     Команда "ss -ula sport = :53" выводит список всех локальных UDP-соединений, где порт назначения равен 53. В данном случае выводится только одно соединение, которое относится к DNS-резолверу, работающему на хосте, и соединение находится в состоянии "UNCONN" (unconnected) - то есть, это соединение не установлено, потому что не было отправлено и не было получено никаких пакетов.
     Состояние "TIME-WAIT" используется для установленных TCP-соединений, которые уже были завершены (когда обе стороны передачи данных закрыли соединение), но еще не полностью завершены на уровне сетевого протокола. Данный режим устанавливается для того, чтобы гарантировать, что все пакеты, которые могут задержаться в сети, будут доставлены до другой стороны и только после этого соединение будет окончательно завершено. Таким образом, состояние "TIME-WAIT" не применимо к UDP-соединениям, поэтому в данном случае в "State" присутствует только "UNCONN".
    ```


7. Обладая знаниями о том, как штатным образом завершается соединение (FIN от инициатора, FIN-ACK от ответчика, ACK от инициатора), опишите в каких состояниях будет находиться TCP соединение в каждый момент времени на клиенте и на сервере при завершении. Схема переходов состояния соединения вам в этом поможет.   
   ```
   Штатное завершение соединения в TCP происходит в три этапа и включает переходы между различными состояниями соединения на стороне клиента и сервера.
     1. Инициатор отправляет FIN.
      На данном этапе соединение находится в состоянии ESTABLISHED на стороне клиента и сервера. Когда клиент отправляет FIN, он переходит в состояние FIN_WAIT1, а сервер в состояние CLOSE_WAIT.
     2. Ответчик отправляет FIN-ACK.
      Когда сервер получает FIN от клиента, он отправляет FIN-ACK в ответ и переходит в состояние LAST_ACK. Клиент в свою очередь переходит в состояние FIN_WAIT2 после получения FIN-ACK.
     3. Инициатор отправляет ACK.
      Когда клиент получает FIN-ACK от сервера, он переходит в состояние TIME_WAIT и отправляет ACK в ответ. Это состояние нужно для того, чтобы гарантировать, что все пакеты, связанные с соединением, дошли до конечной точки. После того, как клиент отправляет ACK, он закрывает соединение и переходит в состояние CLOSED. Сервер также переходит в состояние CLOSED, когда получает ACK от клиента.

   ```

1. TCP порт – 16 битное число. Предположим, 2 находящихся в одной сети хоста устанавливают между собой соединения. Каким будет теоретическое максимальное число соединений, ограниченное только лишь параметрами L4, которое параллельно может установить клиент с одного IP адреса к серверу с одним IP адресом? Сколько соединений сможет обслужить сервер от одного клиента? А если клиентов больше одного?   
    ```
    В соответствии со стандартом TCP, 65535 различных портов может быть использовано для установки соединений, поэтому максимальное число параллельных соединений между клиентом и сервером с одним IP адресом составляет 65535.   
    Сервер может обслуживать несколько соединений от одного клиента. Количество соединений, которое может быть установлено между сервером и клиентом, ограничено только ресурсами сервера и клиента, а также настройками TCP. Количество одновременных соединений от одного клиента зависит от максимального количества портов, которые может использовать клиент.    
    Если клиентов несколько, то количество одновременных соединений от каждого клиента ограничивается аналогично и зависит от доступных ресурсов и настроек TCP. Общее количество одновременных соединений будет зависеть от общего количества клиентов и объема ресурсов на сервере.

    ```

1. Может ли сложиться ситуация, при которой большое число соединений TCP на хосте находятся в состоянии  `TIME-WAIT`? Если да, то является ли она хорошей или плохой? Подкрепите свой ответ пояснением той или иной оценки.   
      ```
    Возможна ситуация, когда на хосте находится большое количество соединений TCP в состоянии TIME-WAIT. Это может произойти в случае частого открытия и закрытия соединений, особенно в высоконагруженных сетях.        
          
    Эта ситуация может быть как положительной, так и отрицательной. С одной стороны, TIME-WAIT состояние является частью стандартного процесса закрытия соединения и обеспечивает корректность передачи данных. Кроме того, оно предотвращает появление дублирующихся пакетов, которые могут быть восприняты как новые соединения.   
    
    С другой стороны, большое количество соединений в состоянии TIME-WAIT может занять много ресурсов системы, что может привести к нехватке свободных портов и ресурсов, которые могут быть необходимы для установления новых соединений. Это может вызвать задержки и сбои в работе сети.   
    
    Нужно находить баланс между количеством соединений, которые можно открыть и закрыть, и ресурсами системы, чтобы избежать проблем с недостатком свободных портов и ресурсов.   
    
      ```

1. Чем особенно плоха фрагментация UDP относительно фрагментации TCP?   
    ```
    Фрагментация UDP более подвержена ошибкам и потере данных, чем фрагментация TCP, и поэтому должна использоваться с осторожностью в критических приложениях, требующих надежности и целостности данных.
    ```

1. Если бы вы строили систему удаленного сбора логов, то есть систему, в которой несколько хостов отправяют на центральный узел генерируемые приложениями логи (предположим, что логи – текстовая информация), какой протокол транспортного уровня вы выбрали бы и почему? Проверьте ваше предположение самостоятельно, узнав о стандартном протоколе syslog.   
    ```
    Протокол syslog используется для централизованного сбора, обработки и хранения лог-файлов различных устройств и приложений. Он поддерживает отправку лог-сообщений по протоколу UDP или TCP, в зависимости от настроек. Однако, по умолчанию syslog использует UDP. Это связано с тем, что syslog не требует надежной доставки сообщений, поскольку утерянные сообщения могут быть восстановлены на уровне приложения.   
    Однако, если мы говорим о системе удаленного сбора логов, где собираются критически важные данные, то использование UDP может привести к потере значительной части лог-сообщений в случае перегрузки сети или проблем с передачей данных. Поэтому использование TCP в данном случае является более предпочтительным вариантом.
    
    ```

1. Сколько портов TCP находится в состоянии прослушивания на вашей виртуальной машине с Ubuntu, и каким процессам они принадлежат?   
          ```
               vagrant@vagrant:~$ sudo lsof -iTCP -sTCP:LISTEN
          COMMAND    PID            USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
          systemd-r  656 systemd-resolve   13u  IPv4  21848      0t0  TCP localhost:domain (LISTEN)
          sshd      1586            root    3u  IPv4  25384      0t0  TCP *:ssh (LISTEN)
          sshd      1586            root    4u  IPv6  25386      0t0  TCP *:ssh (LISTEN)

          ```   
          ## Или так:

          ```
           netstat -tlnp
      (Not all processes could be identified, non-owned process info
       will not be shown, you would have to be root to see it all.)
      Active Internet connections (only servers)
      Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
      tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -
      tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -
      tcp6       0      0 :::22                   :::*                    LISTEN      -

          ```

1. Какой ключ нужно добавить в `tcpdump`, чтобы он начал выводить не только заголовки, но и содержимое фреймов в текстовом виде? А в текстовом и шестнадцатиричном?   
        ```
          Команда tcpdump с флагом -A выводит содержимое пакетов в текстовом формате, а флаг -X - в шестнадцатеричном и текстовом форматах одновременно.
        ```

1. Попробуйте собрать дамп трафика с помощью `tcpdump` на основном интерфейсе вашей виртуальной машины и посмотреть его через tshark или Wireshark (можно ограничить число пакетов `-c 100`). Встретились ли вам какие-то установленные флаги Internet Protocol (не флаги TCP, а флаги IP)? Узнайте, какие флаги бывают. Как на самом деле называется стандарт Ethernet, фреймы которого попали в ваш дамп? Можно ли где-то в дампе увидеть OUI?   

        ```
        vagrant@vagrant:~$ sudo tcpdump -i eth0 -c 100 -w dump.pcap
        tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes   
        vagrant@vagrant:~$ tshark -r dump.pcap
        1   0.000000    10.0.2.15 → 10.0.2.2     SSH 154 Server: Encrypted packet (len=100)
        2   0.000762     10.0.2.2 → 10.0.2.15    TCP 60 57706 → 22 [ACK] Seq=1 Ack=101 Win=65535 Len=0
        3   7.961419     10.0.2.2 → 10.0.2.15    SSH 114 Client: Encrypted packet (len=60)
        4   8.005342    10.0.2.15 → 10.0.2.2     TCP 54 22 → 57706 [ACK] Seq=101 Ack=61 Win=62780 Len=0
        5  19.104700     10.0.2.2 → 10.0.2.15    SSH 90 Client: Encrypted packet (len=36)
        6  19.104730    10.0.2.15 → 10.0.2.2     TCP 54 22 → 57706 [ACK] Seq=101 Ack=97 Win=62780 Len=0
        7  19.105163    10.0.2.15 → 10.0.2.2     SSH 90 Server: Encrypted packet (len=36)
        8  19.105463     10.0.2.2 → 10.0.2.15    TCP 60 57706 → 22 [ACK] Seq=97 Ack=137 Win=65535 Len=0



        ```   
        ```
         Протокол IP не упоминается явно, но он используется для маршрутизации пакетов.   

         В IPv4 заголовке протокола IP могут быть установлены следующие флаги:   
          DF (Don't Fragment) - указывает, что пакет не должен быть фрагментирован         
          MF (More Fragments) - указывает, что это не последний фрагмент пакета         
          Fragment Offset - определяет позицию фрагмента внутри исходного пакета      

          OUI (Organizationally Unique Identifier) - это идентификатор уникальной организации, который используется в качестве первых трех байтов MAC-адреса. OUI может помочь идентифицировать производителя    устройства. В дампе трафика можно увидеть OUI в MAC-адресах.

        ```

 
 ---

## Как сдавать задания

Обязательными к выполнению являются задачи без указания звездочки. Их выполнение необходимо для получения зачета и диплома о профессиональной переподготовке.

Задачи со звездочкой (*) являются дополнительными задачами и/или задачами повышенной сложности. Они не являются обязательными к выполнению, но помогут вам глубже понять тему.

Домашнее задание выполните в файле readme.md в github репозитории. В личном кабинете отправьте на проверку ссылку на .md-файл в вашем репозитории.

Также вы можете выполнить задание в [Google Docs](https://docs.google.com/document/u/0/?tgif=d) и отправить в личном кабинете на проверку ссылку на ваш документ.
Название файла Google Docs должно содержать номер лекции и фамилию студента. Пример названия: "1.1. Введение в DevOps — Сусанна Алиева".

Если необходимо прикрепить дополнительные ссылки, просто добавьте их в свой Google Docs.

Перед тем как выслать ссылку, убедитесь, что ее содержимое не является приватным (открыто на комментирование всем, у кого есть ссылка), иначе преподаватель не сможет проверить работу. Чтобы это проверить, откройте ссылку в браузере в режиме инкогнито.

[Как предоставить доступ к файлам и папкам на Google Диске](https://support.google.com/docs/answer/2494822?hl=ru&co=GENIE.Platform%3DDesktop)

[Как запустить chrome в режиме инкогнито ](https://support.google.com/chrome/answer/95464?co=GENIE.Platform%3DDesktop&hl=ru)

[Как запустить  Safari в режиме инкогнито ](https://support.apple.com/ru-ru/guide/safari/ibrw1069/mac)

Любые вопросы по решению задач задавайте в чате Slack.

---
